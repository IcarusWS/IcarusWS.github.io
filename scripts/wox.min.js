/*
 * wox.min.js
 * Wox Webframework _main_
*/
var wox = {};

// Storage for all objects to be rendered

// Render Engine
wox = {

    elements: [],

    /**
    * render: renders a page
    * @param assign Assigns an element to a specific source
    */

    assign: function (id, url, options = {}) {

        // Store the data into the str
        wox.elements.push({ "url": url, "id": id });

        // Post data to console
        console.log("Assigned element: " + id + " -> " + url);

        // Execute XML Request to document
        if (!options.dontRender) {
            wox.elementRequest(url);
        }


    },

    multipleAssign: function (toAssign = {}) {

        for (var key in toAssign) {

            wox.elements.push({ "url": toAssign[key], "id": key });

            wox.elementRequest(toAssign[key]);

        }

    },

    render: function (id) {
        console.log(wox.elements);
    },

    elementRequest: function (url) {
        // Create a new XMLHttpRequest object
        var request = new XMLHttpRequest();

        // Store the id of the container
        var id = wox.elements.find(obj => {
            return obj.url === url;
        }).id;

        // Assign a function to the onreadystatechange event of the request (When the request recieves a response)
        request.onreadystatechange = function () {

            // If the request is succesful: execute this code
            if (request.readyState == 4 && request.status == 200) {

                if (!wox.elements.find(obj => {
                    return obj.url === url;
                }).id) {
                    console.log("Critical error in Wox base file: Request URL has no valid element ID (contact a developer)")
                }

                var responseBody = request.response;

                // Apply data
                wox.changeElement(id, responseBody);

            }
            else if (request.status == 404) {
                wox.changeElement(id, "Error: Resource couldn't be found (" + url + ")");
            }

        }
        request.open("GET", url, true);
        return request.send();
    },

    changeElement: function (id, body) {

        document.getElementById(id).innerHTML = body;


        return true;

    }

}

wox.utils = {

}
